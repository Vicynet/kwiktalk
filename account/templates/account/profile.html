{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{ user.get_full_name }} KwikTalk - Profile</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/column.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;500&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  </head>
  <body class="body-style">
  {% block content %}

    <nav class="navbar sticky-top navbar-expand-lg navbar-light navbar-color shadow-sm" id="navbar-padding">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="#"><img class="img" src="{% static 'img/kwiktalk-logo.svg' %}" width="50px" height="50px" alt="logo"> KwikTalk</a>

      </nav>
      <script>
        var prevScrollpos = window.pageYOffset;
        window.onscroll = function() {
            var currentScrollPos = window.pageYOffset;
            if (prevScrollpos > currentScrollPos) {
                document.getElementById("navbar-padding").style.top = "0";
            } else {
                document.getElementById("navbar-padding").style.top = "-55px";
            }
            prevScrollpos = currentScrollPos;
        }
      </script>

      <div class="container-fluid second-nav sticky-top" style="background-color: #2E306B !important;">

            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            </form>
            <span class="ml-auto">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" style="background-color: #E62E78 !important; border-color: #E62E78 !important;">Write a post</button>
                    <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                        <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                    </svg>
                &nbsp;
                <!-- <div class="dropdown"> -->
                    <button type="button" class="btn btn-secondary dropdown-toggle" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="background-color: #2E306B !important; color: white; border: none !important;">
                    <img src="../../../media/{{ user.profile.display_picture }}" id="previe"  width="30px" height="30px" style="border-radius: 50px;">
                    <span style="color: white">{{ request.user.first_name|capfirst }}</span> </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                        <a href="{% url "edit" %}" class="dropdown-item" type="button" role="button" aria-pressed="true">Account settings</a>
                            <div class="dropdown-divider"></div>
                        <a href="{% url "logout" %}" class="dropdown-item" type="button" role="button" aria-pressed="true">Log out</a>
                    </div>
                <!-- </div> -->
            </span>
      </div>
      <div class="container-fluid main-body">
          <div class="row">
              <div class="col-md-3 main-body-inner">
                <div class="left-sidebar">
                    <p>
                        <h6 class="post-tag-head">Account Summary</h6>
                        <div class="tag-sidebar-item" style="overflow-y: hidden;height: 0em;"></div>
                    {% with total_followers=user.followers.count  %}

                            <p class="post-tag" style="margin-left: 1em;">3 Post(s) Published</p>
                            <p style="margin-left: 1em" class="friend-button">
                                <button type="button" class="btn btn-dark">
                                    Friends <span class="badge badge-light">{{ user.profile.get_friends_number }}</span>
                                </button>
                                    {% for friend in user.profile.get_friends %}
                                    <p style="margin-left: 1em;">{{ friend|capfirst }}</p>
                             </p>
                {% endfor %}
{#                        <a href="#" style="margin-left: 0.7em;" data-id="{{ user.id }}" data-action="{% if request.user in user.followers.all %}un{% endif %}follow" class="btn btn-primary" role="button" aria-disabled="true">#}
{#                            {% if request.user not in user.followers.all %}#}
{#                                Follow#}
{#                            {% else %}#}
{#                                Unfollow#}
{#                            {% endif %}#}
{#                        </a>#}
{#                            <button type="button" class="btn btn-primary">Like</button>#}
                    {% endwith %}


                    </p>

                </div>
              </div>
              <div class="col-md-6 main-body-inner1">
                <p>
                    <h6 class="post-head">Timeline</h6>

                  {% for post in user_post %}
                   <div class="post-container">
{#                   {% if user_post == 0 %}#}
{#                       <p>No Posts Yet</p>#}
{#                       {% endif %}#}
                        <div class="feed-post-image-container">
                            <img src="../../../media/{{ post.featured_image }}" id="previe"  width="545px" height="204px" >
                        </div>
                        <div class="container-fluid feed-post-detail">
                            <div class="row feed-post-author-detail">
                                <div class="col-md-4 feed-post-author-image-name-post-date">
                                    <a href="{{ user.get_absolute_url }}">
                                    <div class="feed-post-author-image">
                                        <img src="../../../media/{{ post.user.profile.display_picture }}" id="previe"  width="50px" height="50px" style="border-radius: 50px;">
                                    </div>
                                    </a>
                                    <span>
                                        <!-- <div class="feed-post-author-name-post-date"> -->
                                            <p class="feed-post-author-name">{{ post.user.first_name|capfirst }}</p>
                                            <p class="feed-post-date">{{ post.created_at | timesince}} ago</p>
                                        <!-- </div> -->
                                    </span>
                                </div>

                                <div class="col-md-8 feed-post-title-area">
                                  <div class="post-reactions">
                                    <div class="post-reaction-inner ml-auto">
                                        <p class="time-to-read">[1] likes</p>
                                        <button type="button" class="btn btn-primary">Like</button>
                                    </div>
                                  </div>
                                </div>
                            </div>
                                <div class="post-content">
                                    <p>{{ post.post_body }}</p>
                                </div>
                        </div>
                    </div>
                  {% endfor %}
                </p>
              </div>
              <div class="col-md-3 main-body-inner2">
                <div class="trending-sidebar">
                    <p>
                        <h6 class="trending-sidebar-head"> <p></p>Profile</h6>
                        <div class="trending-sidebar-item">
                            <p class="post-trend-title">
                            <div class="feed-post-author-image" style="display: flex">
                                        <img src="/media/{{ user.profile.display_picture }}" id="previe"  width="50px" height="50px" style="border-radius: 50px;">
                             <button type="button" class="btn btn-primary">
                                    Follow
                                </button>
                                    </div>
                            </p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Fullname</span>
                                {{ user.get_full_name|capfirst }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Email</span>
                                {{ user.email }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Username</span>
                                {{ user.username }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Phone number</span>
                                {{ user.profile.phone_number }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Bio</span>
                                {{ user.profile.bio }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Birthday</span>
                                {{ user.profile.date_of_birth }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Gender</span>
                                {{ user.profile.gender }}</p>
                            <p class="post-trend-title">
                                <span class="badge badge-secondary">Joined</span>
                                {{ user.profile.created_at }}</p>
                        </div>
                    </p>
                </div>
              </div>
          </div>
      </div>

      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">New Post</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form method="post" enctype="multipart/form-data">
                  {% csrf_token %}

                  {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            {{ message|safe }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endfor %}
                  {% endif %}

                <div class="form-group">
                    <label for="message-text" class="col-form-label">KwikTalk Post:</label>
                    <textarea class="form-control" name="post_body" id="message-text"></textarea>
                  </div>
                <div class="form-group">
                    <div class="custom-file">
                      <input type="file" name="featured_image" class="custom-file-input form-control" id="customFile">
                      <label class="custom-file-label" for="customFile">Choose Post Image</label>
                    </div>
                    <img src="https://placehold.it/80x80" id="preview" style="margin-top: 1em;" width="80px" height="80px" class="img-thumbnail">
                  </div>
                  <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Post</button>
            </div>
              </form>
            </div>
          </div>
        </div>
      </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <script src="https://cdn.jsdelivr.net/npm/js-cookie@2.2.1/src/js.cookie.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<script>
    $('a.follow').click(function(e){
        e.preventDefault();
        $.post('{% url "user_follow" %}',
    {
        id: $(this).data('id'),
        action: $(this).data('action')
    },
    function(data){
        if (data['status'] == 'ok') {
        var previous_action = $('a.follow').data('action');
            // toggle data-action
            $('a.follow').data('action', previous_action == 'follow' ? 'unfollow' : 'follow');
// toggle link text
            $('a.follow').text(
previous_action == 'follow' ? 'Unfollow' : 'Follow');
// update total followers
var previous_followers = parseInt(
$('span.count .total').text());
$('span.count .total').text(previous_action == 'follow' ?
previous_followers + 1 : previous_followers - 1);
}
}
);
});

</script>
      <script>
var csrftoken = Cookies.get('csrftoken');
function csrfSafeMethod(method) {
// these HTTP methods do not require CSRF protection
return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
beforeSend: function(xhr, settings) {
if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
xhr.setRequestHeader("X-CSRFToken", csrftoken);
}
}
});
$(document).ready(function(){

    }
    </script>
    <script>
        $(document).on("click", ".browse", function() {
          var file = $(this).parents().find(".file");
          file.trigger("click");
        });
        $('input[type="file"]').change(function(e) {
          var fileName = e.target.files[0].name;
          $("#file").val(fileName);

          var reader = new FileReader();
          reader.onload = function(e) {
            // get loaded data and render thumbnail.
            document.getElementById("preview").src = e.target.result;
          };
          // read the image file as a data URL.
          reader.readAsDataURL(this.files[0]);
        });


        $(document).ready(function() {
          $('input[type="file"]').on("change", function() {
            let filenames = [];
            let files = document.getElementById("customFile").files;
            if (files.length > 1) {
              filenames.push("Total Files (" + files.length + ")");
            } else {
              for (let i in files) {
                if (files.hasOwnProperty(i)) {
                  filenames.push(files[i].name);
                }
              }
            }
            $(this)
              .next(".custom-file-label")
              .html(filenames.join(","));
          });
        });

    </script>
{% endblock %}
  </body>
</html>